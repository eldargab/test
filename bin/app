#!/usr/bin/env node

'use strict'

const program = require('commander')
const go = require('go-async')
const proc = require('../lib/processes')

program.option('-e, --getErrors', 'Print and clear the error registry')
program.option('-w, --worker', 'Run a worker process')

program.parse(process.argv)

function run(p) {
  go(p).get(function(err) {
    if (err) console.error(err.stack)
    process.exit(err ? 1 : 0)
  })
}

if (program.getErrors) {
  run(proc.errorsDumper)
} else if (program.worker) {
  run(proc.worker)
} else {
  run(proc.application)
}
